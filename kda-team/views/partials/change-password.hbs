<!-- Modal Change Password -->
<div class="modal fade" id="ChangePasswordModal" tabindex="-1" role="dialog" aria-labelledby="changePasswordLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="changePasswordLabel">ĐỔI MẬT KHẨU</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="changePasswordForm">
          <div class="form-group">
            <label for="password">Mật khẩu hiện tại</label>
            <input type="password" class="form-control" id="password" placeholder="Nhập mật khẩu hiện tại">
          </div>
          <div class="form-group">
            <label for="newPassword">Mật khẩu mới</label>
            <input type="password" class="form-control" id="newPassword" placeholder="Nhập mật khẩu mới">
          </div>
          <div class="form-group">
            <label for="confirmNewPassword">Xác nhận mật khẩu</label>
            <input type="password" class="form-control" id="confirmNewPassword" placeholder="Xác nhận mật khẩu">
          </div>
          <button type="button" class="btn btn-primary" id="saveNewPassword">Lưu thay đổi</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="/admin/js/core/jquery-3.7.1.min.js"></script>
<script src="/admin/js/core/bootstrap.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    let userId;

    document.querySelector('[data-bs-target="#ChangePasswordModal"]').addEventListener('click', function () {
        userId = this.getAttribute('data-id');
    });

    document.getElementById("saveNewPassword").addEventListener("click", function() {
        const currentPassword = document.getElementById("password").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmNewPassword = document.getElementById("confirmNewPassword").value;

        if (!userId) {
            alert("Không tìm thấy ID người dùng.");
            return;
        }

        const formData = { currentPassword, newPassword, confirmNewPassword };

        fetch(`/users/changePassword/${userId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(data => {
                    throw new Error(data.message);
                });
            }
            return response.json();
        })
        .then(data => {
            alert('Cập nhật thành công!');
            location.reload();
        })
        .catch(error => {
            console.error('Lỗi xảy ra:', error);
            alert('Có lỗi xảy ra');
        });
    });
});

</script>
